/*
 HTML_QuickForm2: support functions for hierselect elements
 Package version @package_version@
 http://pear.php.net/package/HTML_QuickForm2

 Copyright 2006-2011, Alexey Borzov, Bertrand Mansion
 Licensed under new BSD license 
 http://opensource.org/licenses/bsd-license.php
*/
qf.elements.hierselect=function(){function g(b){return function(){setTimeout(function(){if(b.id in qf.elements.hierselect.defaults)for(var c=qf.elements.hierselect.defaults[b.id],d=b.hierselect.next,a=0;a<d.length;a++)qf.elements.hierselect.replaceOptions(document.getElementById(d[a]),qf.elements.hierselect.getOptions(b.id,c.slice(0,a+1))),qf.form.setValue(d[a],c[a+1])},1)}}function h(b){return function(){if(b.id in qf.elements.hierselect.defaults){var c=qf.elements.hierselect.defaults[b.id],d=b.hierselect.next;
qf.form.setValue(b,c[0]);for(var a=0;a<d.length;a++)qf.form.setValue(d[a],c[a+1])}}}function i(b){b=qf.events.fixEvent(b);b.target.hierselect&&0!=b.target.hierselect.next.length&&qf.elements.hierselect.cascade.call(b.target)}return{init:function(b,c){for(var d=[],a=document.getElementById(b[0]),e;b.length&&(e=b.shift());){d.push(e);var f=document.getElementById(e);f.hierselect={previous:d.concat(),next:b.concat(),callback:c};qf.events.addListener(f,"change",i)}qf.events.addListener(a.form,"reset",
g(a));qf.events.addListener(window,"load",h(a))},getValue:function(b){for(var c=[],d=0;d<b.length;d++)c.push(qf.form.getValue(b[d]));return c},replaceOptions:function(b,c){function d(b){var a=document.createElement("div");a.innerHTML=b;return a.childNodes[0]?a.childNodes[0].nodeValue:""}for(var a=b.options.length=0;a<c.values.length;a++)b.options[a]=new Option(-1==String(c.texts[a]).indexOf("&")?c.texts[a]:d(c.texts[a]),c.values[a],!1,!1)},getOptions:function(b,c,d){if(!(b in qf.elements.hierselect.options)||
typeof qf.elements.hierselect.options[b][c.length-1]=="undefined")return qf.elements.hierselect.missingOptions;for(var a=qf.elements.hierselect.options[b][c.length-1],e=c.concat();e.length;){var f=e.shift();if(0==e.length)return f in a||(a[f]=d?d(c,b):qf.elements.hierselect.missingOptions),a[f];else f in a||(a[f]={});a=a[f]}},getAsyncCallback:function(b,c){return function(d){b in qf.elements.hierselect.options||(qf.elements.hierselect.options[b]=[]);typeof qf.elements.hierselect.options[b][c.length-
1]=="undefined"&&(qf.elements.hierselect.options[b][c.length-1]={});for(var a=qf.elements.hierselect.options[b][c.length-1],e=c.concat();e.length;){var f=e.shift();0==e.length?a[f]=d:a=f in a?a[f]:a[f]={}}a=document.getElementById(b).hierselect;e=document.getElementById(a.next[c.length-1]);qf.elements.hierselect.replaceOptions(e,d);c.length<a.next.length&&qf.elements.hierselect.cascade.call(e)}},cascade:function(){var b=qf.elements.hierselect.getValue(this.hierselect.previous);qf.elements.hierselect.replaceOptions(document.getElementById(this.hierselect.next[0]),
qf.elements.hierselect.getOptions(this.hierselect.previous[0],b,this.hierselect.callback));1<this.hierselect.next.length&&qf.elements.hierselect.cascade.call(document.getElementById(this.hierselect.next[0]))},missingOptions:{values:[""],texts:[" "]},options:{},defaults:{}}}();
